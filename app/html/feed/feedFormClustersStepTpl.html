<!--
/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<form name="feedForm">
  <div class="row">
    <div class="sourceReplicationButton"
      ng-repeat="cluster in feed.clusters"
      ng-click="handleCluster(cluster, $index)"
      ng-class="{active: cluster.selected}">
      <div>
        <span class="entypo" 
          ng-class="{
            'circled-down': !cluster.selected || cluster.type === 'source' || archiveCluster.active,
            'circled-cross': cluster.selected && cluster.type !== 'source' && !archiveCluster.active
            }">
        </span>
      </div>
      <div><small>{{capitalize(cluster.type === 'target' ? (archiveCluster.active ? 'archive': 'replication') : cluster.type)}}</small> Cluster</div>
    </div>
    <div class="sourceReplicationButton pull-right"
      ng-click="addCluster()"
      ng-show="!archiveCluster.active">
      <div><span class="entypo circled-plus"></span></div>
      <div><small>Add</small>  Cluster</div>
    </div>
  </div>  

  <div ng-repeat="cluster in feed.clusters" ng-show="cluster.selected">
    <div class="row">
      <h4 class="col-sm-24">{{capitalize(cluster.type)}} Cluster </h4>
    </div>

    <select ng-model="cluster.name" ng-required="true">
      <option ng-repeat="clusterItem in clusterList">{{clusterItem.name}}</option>
    </select>

    <h4 class="col-sm-24"> Retention </h4>

    <div class="col-sm-24 composedField">
      <select ng-model="cluster.retention.action"
        ng-required="true"
        ng-change="updateRetention()">
        <option selected value="chown">Chown</option>
        <option value="delete">Delete</option>
        <option value="chmod">Chmod</option>
        <option ng-show="cluster.type === 'source'" show value="archive">Archive</option>
      </select>
      in
      <input type="text" class="small"
        ng-required="true" ng-model="cluster.retention.quantity"
        ng-pattern="validations.twoDigits.pattern">

      <select ng-model="cluster.retention.unit"
        ng-required="true">
        <option selected value="hours">hours</option>
        <option value="days">days</option>
        <option value="weeks">weeks</option>
        <option value="months">months</option>
      </select>
    </div>

    <h4 class="col-sm-24"> Validity </h4>

    <div class="clearfix hidden-md"></div>

    <div class="col-sm-12">
      <label class="light">Start</label>
    </div>
    <div class="col-sm-12">
      <label class="light">End</label>
    </div>

    <div class="col-sm-6">
      <p class="input-group">
        <input type="text" class="form-control" datepicker-popup="{{startDatePicker.format}}"
          ng-model="cluster.validity.start.date"
          is-open="startDatePicker.opened"
          ng-required="true" />
        <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-click="startDatePicker.open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
        </span>
      </p>
    </div>
    <div class="col-sm-6">
      <timepicker class="timePicker" ng-model="cluster.validity.start.time" hour-step="1" minute-step="1" ></timepicker>
    </div>
    <div class="col-sm-6">
      <p class="input-group">
        <input type="text" class="form-control" datepicker-popup="{{endDatePicker.format}}"
          ng-model="cluster.validity.end.date"
          is-open="endDatePicker.opened"
          ng-required="true"/>
        <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-click="endDatePicker.open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
        </span>
      </p>
    </div>
    <div class="col-sm-6">
      <timepicker class="timePicker" ng-model="cluster.validity.end.time" hour-step="1" minute-step="1" ></timepicker>
    </div>

    <div class="clearfix hidden-md"></div>

    <div class="col-sm-24">
      <label class="light">Timezone</label>
    </div>

    <div class="clearfix hidden-md"></div>

    <div class="col-sm-24">
      <time-zone-select ng-model="feed.timezone"></time-zone-select>
    </div>


    <div class="row dynamic-table-spacer">

      <div class="col-sm-24 feedLocationNavBox nopointer">
        <h4 class="col-sm-10" ng-show="!feed.storage.fileSystem.active">Default Storage type</h4>
        <h4 class="col-sm-10" ng-show="feed.storage.fileSystem.active">Storage type</h4>

        <div class="col-sm-14 feedLocationNav">
          <div class="btn btn-default pull-right" ng-class="{active: feed.storage.catalog.active}">
            Catalog Storage
          </div>
          <div class="btn btn-default pull-right" ng-class="{active: feed.storage.fileSystem.active}">
            File System
          </div>
        </div>
      </div>

      <div class="clearfix hidden-md"></div>

      <div class="col-sm-19">
        <label>Location</label>
        <label class="light">(if not defined, will use default location)
        </label>
      </div>

      <div class="clearfix hidden-md"></div>

      <div class="col-sm-24"
        ng-show="feed.storage.fileSystem.active"
        ng-repeat="location in cluster.storage.fileSystem.locations">
        <label class="light">{{location.type}} path</label>
        <input type="text" class="form-control"
          ng-model="location.path" />
      </div>

      <div class="col-sm-24" ng-show="feed.storage.catalog.active">
        <label class="light">Table uri</label>
        <input type="text" class="form-control" ng-model="cluster.storage.catalog.catalogTable.uri"/>
      </div>
    </div>

  </div>

  <div class="row feedBottomButtons">
    <div class="btn btn-default col-sm-6" ui-sref="main.forms.feed.location">
      Previous
    </div>
    <div class="btn btn-default col-sm-6 pull-right"
         ng-disabled="feedForm.$invalid"
         ui-sref="forms.feed.summary">
      Next
    </div>
    <u class="col-sm-3 pull-right" ui-sref="main">
      Cancel
    </u>
  </div>
</form>